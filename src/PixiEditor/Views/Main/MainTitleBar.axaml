<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ui="clr-namespace:PixiEditor.Extensions.UI;assembly=PixiEditor.Extensions"
             xmlns:xaml="clr-namespace:PixiEditor.Models.Commands.XAML"
             xmlns:dataHolders="clr-namespace:PixiEditor.Models.UserData"
             xmlns:viewModels="clr-namespace:PixiEditor.ViewModels"
             xmlns:dialogs="clr-namespace:PixiEditor.Views.Dialogs"
             xmlns:input="clr-namespace:PixiEditor.Views.Input;assembly=PixiEditor.UI.Common"
             xmlns:menu="clr-namespace:PixiEditor.ViewModels.Menu"
             xmlns:main="clr-namespace:PixiEditor.Views.Main"
             xmlns:converters="clr-namespace:PixiEditor.Helpers.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:DataType="menu:MenuBarViewModel"
             x:Class="PixiEditor.Views.Main.MainTitleBar">
    <Design.DataContext>
        <menu:MenuBarViewModel />
    </Design.DataContext>
    <Grid>
        <dialogs:DialogTitleBar
            DockPanel.Dock="Top">
            <dialogs:DialogTitleBar.AdditionalElement>
                <Border BorderThickness="1" BorderBrush="{DynamicResource AccentColor}"
                        Padding="5 0" CornerRadius="5" Height="25"
                        IsVisible="{Binding Path=AdditionalContentSubViewModel.IsSupporterPackAvailable, FallbackValue=False}">
                    <TextBlock VerticalAlignment="Center"
                               ui:Translator.Key="PixiEditor.SupporterPack:AWESOME_SUPPORTER" />
                </Border>
            </dialogs:DialogTitleBar.AdditionalElement>
        </dialogs:DialogTitleBar>
        <ToggleButton Name="LogoButton" Padding="0" BorderThickness="0" DockPanel.Dock="Left"
                      HorizontalAlignment="Left" Width="20" Height="20">
            <ToggleButton.Margin>
                <OnPlatform>
                    <OnPlatform.macOS>
                        <Thickness>75, 0, 0, 0</Thickness>
                    </OnPlatform.macOS>
                    <OnPlatform.Default>
                        <Thickness>10, 0, 0, 0</Thickness>
                    </OnPlatform.Default>
                </OnPlatform>
            </ToggleButton.Margin>
            <ToggleButton.Background>
                <VisualBrush>
                    <VisualBrush.Visual>
                        <Svg Path="/Images/PixiEditorLogo.svg" />
                    </VisualBrush.Visual>
                </VisualBrush>
            </ToggleButton.Background>
            <ToggleButton.Flyout>
                <Flyout Placement="BottomEdgeAlignedLeft">
                    <Flyout.Content>
                        <StackPanel Margin="5">
                            <TextBlock Text="PixiEditor" FontSize="20" />
                            <TextBlock Text="{Binding UpdateViewModel.VersionText}" />
                            <TextBlock Text="{Binding UpdateViewModel.UpdateStateString}" />
                            <Button ui:Translator.Key="DOWNLOAD_UPDATE"
                                    Command="{Binding UpdateViewModel.DownloadCommand}"
                                    IsVisible="{Binding UpdateViewModel.IsUpdateAvailable}" />
                            <Button ui:Translator.Key="SWITCH_TO_NEW_VERSION"
                                    Command="{Binding UpdateViewModel.InstallCommand}"
                                    IsVisible="{Binding UpdateViewModel.UpdateReadyToInstall}" />
                        </StackPanel>
                    </Flyout.Content>
                </Flyout>
            </ToggleButton.Flyout>
        </ToggleButton>

        <StackPanel Orientation="Horizontal">
            <StackPanel.Margin>
                <OnPlatform>
                    <OnPlatform.macOS>
                        <Thickness>95, 0, 0, 0</Thickness>
                    </OnPlatform.macOS>
                </OnPlatform>
            </StackPanel.Margin>
            <xaml:Menu IsVisible="{OnPlatform macOS=false, Default=true}"
                       Margin="40, 0, 0, 0"
                       DockPanel.Dock="Left"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Center"
                       ItemsSource="{Binding MenuEntries}"
                       Background="Transparent" />
            <Border DockPanel.Dock="Left" Height="25" Width="150"
                    Background="{DynamicResource ThemeBackgroundBrush}"
                    CornerRadius="5" BorderThickness="1"
                    Margin="10,0,0,0"
                    Cursor="IBeam">
                <Border.Styles>
                    <Style Selector="Border">
                        <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorderMidBrush}" />
                    </Style>
                    <Style Selector="Border:pointerover">
                        <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorderHighBrush}" />
                    </Style>
                </Border.Styles>
                <Interaction.Behaviors>
                    <EventTriggerBehavior
                        EventName="PointerPressed">
                        <InvokeCommandAction
                            Command="{xaml:Command PixiEditor.Search.Toggle}" />
                    </EventTriggerBehavior>
                </Interaction.Behaviors>
                <Grid Margin="5,0" VerticalAlignment="Center">
                    <TextBlock ui:Translator.Key="SEARCH" />
                    <TextBlock
                        Text="{xaml:ShortcutBinding PixiEditor.Search.Toggle, Converter={converters:KeyToStringConverter}}"
                        HorizontalAlignment="Right" />
                </Grid>
            </Border>
        </StackPanel>
        <main:MiniAnimationPlayer
            Name="MiniPlayer"
            ActiveFrame="{Binding ActiveDocument.AnimationDataViewModel.ActiveFrameBindable, Source={viewModels:MainVM DocumentManagerSVM}, Mode=TwoWay}"
            FramesCount="{Binding ActiveDocument.AnimationDataViewModel.FramesCount, Source={viewModels:MainVM DocumentManagerSVM}}"
            IsPlaying="{Binding ActiveDocument.AnimationDataViewModel.IsPlayingBindable, Source={viewModels:MainVM DocumentManagerSVM}, Mode=TwoWay}"
            Margin="0 4" />
    </Grid>
</UserControl>